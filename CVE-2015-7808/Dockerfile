FROM ubuntu:14.04.5
MAINTAINER xk0n

ADD src/ /tmp/
WORKDIR /tmp/

# change source to aliyun
RUN mv /etc/apt/source.list /etc/apt/source.list.old && \
    sed -i 's/archive.ubuntu.com/mirrors.aliyun.com/g' /etc/apt/sources.list && \
    apt-get update 

# install mysql with password toor
RUN echo 'mysql-server mysql-server/root_password password toor' | debconf-set-selections && \
    echo 'mysql-server mysql-server/root_password_again password toor' | debconf-set-selections  && \
    apt-get -y install mysql-server

RUN apt-get install -y apache2 php5 php5-mysql php5-gd unzip && \
    service apache2 start && \
    a2enmod rewrite && \
    service apache2 restart && \
    mkdir -p /var/www/vb5 && \
    unzip vBulletin-5.1.5.zip && \
    mv vBulletin_Connect_5.1.5/upload/* /var/www/vb5/ && \
    mv vb5.conf /etc/apache2/sites-available/ && \
    mv /var/www/vb5/htaccess.txt /var/www/vb5/.htaccess && \
    chown -R www-data:www-data /var/www/vb5 && \
    a2dissite 000-default.conf && \
    a2ensite vb5.conf && \
    service apache2 reload

RUN service mysql start && \
    mysql -u root --password=toor -e "create database vb5;grant all privileges on vb5.* to vbadmin@'localhost' identified by 'vbpass' with grant option;flush privileges"




